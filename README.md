# Node.Js

é¦–æ¬¡å¼€ä»“äº--------2023.06.12

ç¬¬0ç«  Promise åœ¨JSæ¿å— å®Œç»“

---

## ç¬¬1ç«  æ¦‚è¿°

nodeJsï¼šæ˜¯JavaScriptè¿è¡Œæ—¶çš„å¼•æ“

ä¸ºä»€ä¹ˆé€‚åˆåç«¯ç¼–ç¨‹ï¼Ÿ

- å•çº¿ç¨‹ï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨ï¼Œéé˜»å¡å‹çš„IOæ¨¡å‹

- é€‚åˆæ„å»ºè¶…å¿«é€Ÿã€å¯æ‰©å±•çš„æ•°æ®å¯†é›†å‹åº”ç”¨ç¨‹åº

- å‰åç«¯ä»£ç ç»Ÿä¸€

- å…è´¹èµ„æºåº“

- å¤§å‹æ´»åŠ¨ç¤¾åŒº

æç¤ºï¼šNodeJSä¸ä½¿ç”¨åœ¨å¤šçº¿ç¨‹ã€ç¹é‡æœåŠ¡å™¨ç«¯çš„åº”ç”¨ç¨‹åºä¸Š

#### 1.1 æ–‡ä»¶æ“ä½œ

é¦–å…ˆé€šè¿‡`require('fs)`è·å–æ–‡ä»¶æ¨¡å—

| åç§°   | è¯´æ˜                                                                   | è¡¥å……                     |
| ---- | -------------------------------------------------------------------- | ---------------------- |
| è¯»å–æ–‡ä»¶ | `fs.readFileSync('./txt/input.txt','utf-8')`                         | ç¤ºä¾‹ä¸­çš„å‚æ•°ï¼Œåœ°å€å’Œç¼–ç æ–¹å¼         |
| å†™å…¥æ–‡ä»¶ | `fs.writeFileSync('./txt/output.txt',textOut);`                      | ç¤ºä¾‹ä¸­çš„å‚æ•°ï¼Œåœ°å€å’Œå†…å®¹           |
| å¼‚æ­¥è¯»å– | `fs.readFile('./txt/start.txt', 'utf-8', (err, data1) => {}`         | å‚æ•°ï¼Œæ–‡ä»¶åœ°å€ã€ç¼–ç æ ¼å¼ã€å›è°ƒå‡½æ•°      |
| å¼‚æ­¥å†™å…¥ | `fs.writeFile('./txt/final.txt','abcde','utf-8', (err, data4) => {}` | å‚æ•°ï¼Œæ–‡ä»¶åœ°å€ã€å†™å…¥å†…å®¹ã€ç¼–ç æ ¼å¼ã€å›è°ƒå‡½æ•° |

#### 1.2 åˆ›å»ºã€ç›‘å¬æœåŠ¡å™¨

é¦–å…ˆå¼•å…¥`const http = require('http')`æ¨¡å—

1. åˆ›å»ºæœåŠ¡å™¨

```js
const server = http.createServer((req,res)=>{
    res.end('Hello from the server!')
})
```

2. ç›‘å¬æœåŠ¡å™¨

è¯´æ˜ï¼Œè®¾ç½®ç«¯å£å·ã€åœ°å€ã€å›è°ƒå‡½æ•°ï¼ˆå½“è¢«è®¿é—®æ—¶è§¦å‘ï¼‰

```js
server.listen(8001,'127.0.0.1',()=>{
    console.log('Listening to requests on port 8001')
})
```

#### 1.3 ä½¿ç”¨æœåŠ¡å™¨ã€è®¾ç½®è·¯ç”±

æŒ‡ä»¤å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦‚æœå¯¹æ–‡ä»¶è¿›è¡Œæ›´æ”¹ï¼Œè¦è®°å¾—é‡å¯æœåŠ¡å™¨

`node index.js`

è®¾ç½®è·¯ç”±

- è·å–è¯·æ±‚è·¯ç”±ï¼Œ`req.url`

- è®¾ç½®å“åº”å¤´ï¼Œ`res.writeHead(çŠ¶æ€ç ,{å“åº”å¤´})`

ç¤ºä¾‹ï¼š

```js
res.writeHead(404,{
            'Content-type':'text/html',
            'my-own-header':'hello-world'
        })
```

#### 1.4 æ€»ç»“

è¿‡å»å®‰è£…ä¾èµ–çš„å‘½ä»¤

`npm install slugify --save`

ç°åœ¨å¯ä»¥çœç•¥æ‰

`--save`

å…¨å±€å®‰è£…

`--global`

ğŸ˜‰ç›‘å¬æ”¹å˜ï¼Œè‡ªåŠ¨é‡å¯nodeæœåŠ¡å™¨

`npm install nodemon --save-dev`

**npmæŒ‡ä»¤**

| æŒ‡ä»¤              | è§£é‡Š       | å¤‡æ³¨  |
| --------------- | -------- | --- |
| `npm updated`   | æ£€æŸ¥ä¾èµ–æ˜¯å¦è¿‡æœŸ |     |
| `npm uninstall` |          |     |
| `npm update`    | æ›´æ–°ä¾èµ–     |     |

**ç‰ˆæœ¬å·è¯´æ˜**

è¡¨ç°å½¢å¼ï¼š`xx.yy.zz`

- `zz`ï¼šå‘ç”Ÿæ›´æ–°ï¼Œä¿®å¤åŒ…ä¸­çš„é”™è¯¯

- `yy`ï¼šå‘ç”Ÿæ›´æ–°ï¼Œå‘å¸ƒæ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹

- `xx`ï¼šå‘ç”Ÿæ›´æ–°ï¼Œæ¬¡ä»£ç‰ˆæœ¬ä»£ç å¯èƒ½å¤±æ•ˆ

---

## ç¬¬äºŒç«  Webæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

#### 2.1 è¯·æ±‚å“åº”æ¨¡å‹

è¯·æ±‚ç”±ï¼š

1. åè®®ã€åŸŸåã€èµ„æºå

2. åè®®ã€IPåœ°å€ã€ç«¯å£å·(https çš„é»˜è®¤ç«¯å£å·ä¸º443ã€httpçš„é»˜è®¤ç«¯å£å·ä¸º80)

`request`:

- è¯·æ±‚æ–¹å¼ã€è¯·æ±‚ç›®æ ‡ã€HTTPç‰ˆæœ¬

- è¯·æ±‚å¤´

- è¯·æ±‚ä½“

`response`:

- HTTPç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€æ¶ˆæ¯

- å“åº”å¤´

- å“åº”ä½“

è¯·æ±‚åˆ°å“åº”çš„æ•´ä¸ªè¿‡ç¨‹ï¼š

1. å°†è¯·æ±‚è¿æ¥å‘é€è‡³DNSæœåŠ¡å™¨ï¼Œè·å–å¯¹åº”çš„IPåœ°å€å’Œç«¯å£å·

2. æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘èµ·`TCP/IP`å¥—æ¥å­—è¿æ¥

3. å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚

4. æœåŠ¡å™¨è¿”å›å“åº”

> æç¤ºï¼š
> 
> `http`ä¸`https`ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼Œ`https`ä½¿ç”¨äº†TLSæˆ–SSLåŠ å¯†
> 
> TCP(é€šè®¯ä¼ è¾“åè®®)ï¼šåˆ†è§£è¯·æ±‚ï¼Œæ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®åŒ…å°å—
> 
> IP(ç½‘ç»œé€šä¿¡åè®®)ï¼šå°†æ•°æ®åŒ…å…¨éƒ¨å‘é€è‡³å®¢æˆ·ç«¯

5. å®¢æˆ·ç«¯è¯»å–æ•°æ® 
   
   - è¯»å–å…¥å£æ–‡ä»¶(`.html`)
   
   - æ‰«æèµ„æºæ–‡ä»¶(`.css,.js`)
   
   - å‘ˆç°é¡µé¢

#### 2.2 å‰ç«¯å¯¹æ¯”åç«¯

ä¸¤ç§ç½‘ç«™å½¢å¼ï¼š

1. åŠ¨æ€ç½‘ç«™ï¼Œæ•°æ®åº“æ‹¿åˆ°æ•°æ®ã€ä½¿ç”¨æ¨¡æ¿ã€ç”Ÿæˆç½‘ç«™ã€å‘é€ç»™æµè§ˆå™¨

2. APIï¼Œæ•°æ®åº“æ‹¿åˆ°æ•°æ®ã€ç”Ÿæˆ`JSON`æ ¼å¼ã€å‘é€ç»™æµè§ˆå™¨

> åŠ¨æ€ç½‘ç«™ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯åœ¨æœåŠ¡å™¨ä¸Šå®Œæˆçš„ï¼Œä¹Ÿè¢«ç§°ä¸ºSSRï¼ˆæœåŠ¡å™¨æ¸²æŸ“ï¼‰
> 
> APIï¼Œå› ä¸ºè·å–æ•°æ®è¿‡ç¨‹å‘ç”Ÿåœ¨æœåŠ¡å™¨ä¸Šï¼Œè€Œæµè§ˆå™¨æ¸²æŸ“å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œå› æ­¤è¢«ç§°ä¸ºCSRï¼ˆå®¢æˆ·ç«¯æ¸²æŸ“ï¼‰

---

## ç¬¬ä¸‰ç«  Node.js

#### 3.1 node.js çš„æ¶æ„

ç»„æˆéƒ¨åˆ†ï¼š`v8å¼•æ“`ã€`libuv`ï¼ˆå…³æ³¨å¼‚æ­¥çš„IOã€äº‹ä»¶å¾ªç¯ã€çº¿ç¨‹æ± ï¼‰ã€`http-parser`ã€`c-ares`ã€`OpenSSL`ã€`zlib`

ä¸»ä½“æ˜¯`v8å¼•æ“`ã€`libuv`

å…¶ä½™çš„ä»‹ç»å¦‚ä¸‹ï¼š

1. `http-parser`ï¼Œç”¨äºè§£æ`http`

2. `c-ares`ï¼Œç”¨äºDNSè¯·æ±‚çš„ä¸œè¥¿

3. `OpenSSL`ï¼Œä¿å­˜è®°å½•

4. `zlib`ï¼Œç”¨äºå‹ç¼©

**node.js çš„è¿è¡Œ**

`Node.js`è¿è¡Œåœ¨å•çº¿ç¨‹çš„ç¯å¢ƒä¸­ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

1. åˆå§‹åŒ–é¡¹ç›®

2. æ‰§è¡Œé¡¶å±‚ä»£ç 

3. è·å–æ¨¡å—

4. æ³¨å†Œäº‹ä»¶å¾ªç¯

5. å¼€å¯äº‹ä»¶å¾ªç¯ï¼ˆæ ¸å¿ƒï¼‰

å¦å¤–ï¼Œå› ä¸ºäº‹ä»¶å¾ªç¯ä»»åŠ¡ç¹é‡ï¼Œ`libuv`ä¼šå¼€å¯çº¿ç¨‹æ± ï¼Œå°†äº‹ä»¶å¾ªç¯çš„å…¶å®ƒä»»åŠ¡åˆ†å‰²ä¸ºæœ€å¤š128ä¸ªçº¿ç¨‹ï¼Œä¸»è¦åˆ†ç±»ä¸ºå››ç§ä»»åŠ¡ï¼šæ–‡ä»¶å·¥ä½œã€åŠ å¯†ä¸è§£å¯†ã€å‹ç¼©ã€DNSæŸ¥é˜…ï¼Œä»¥å‡è½»äº‹ä»¶å¾ªç¯çš„å‹åŠ›ï¼Œä½¿å¾—äº‹ä»¶å¾ªç¯ä¸­ä¿ç•™ä¸»è¦ä»»åŠ¡

#### 3.2 Node.jsæ ¸å¿ƒ äº‹ä»¶å¾ªç¯

1. éé¡¶å±‚ä»£ç éƒ½ä¼šåœ¨äº‹ä»¶å¾ªç¯ä½“ä¸­è¿è¡Œ

2. Node.jså›´ç»•å›è°ƒå‡½æ•°æ„å»ºçš„

3. äº‹ä»¶é©±åŠ¨ç»“æ„ï¼Œäº‹ä»¶å‘å‡ºã€äº‹ä»¶å¾ªç¯ä½“è·å–äº‹ä»¶ã€å›è°ƒè¢«åé¦ˆ

4. äº‹ä»¶å¾ªç¯æ˜¯ç²¾å¿ƒå¸ƒç½®çš„

æœåŠ¡å¼€å¯ä¹‹åä¼šå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæ¯å½“æ¥æ”¶åˆ°æ–°çš„è¯·æ±‚æ—¶ï¼Œå¤„ç†è¯·æ±‚ï¼Œåé¦ˆæ•°æ®ï¼Œå¹¶å†æ¬¡è¿›å…¥ç›‘å¬çŠ¶æ€ï¼Œç›´åˆ°æœåŠ¡ç»“æŸä¸ºæ­¢ã€‚

#### 3.3 Node.js æ‰§è¡Œå®è·µ

```js
// 2. è·å–æ¨¡å—æ–‡ä»¶
const fs = require("fs");
const crypto = require("crypto")
const start = new Date()

process.env.UV_THREADPOOL_SIZE = 2


// 3. é€ä¸€è·å–äº‹ä»¶
setTimeout(() => console.log("Timer 1 finished"), 0)  //  1
setImmediate(() => console.log("Immediate 1 finished"))  //  2

fs.readFile("./test-file.txt", () => {     // 3
    console.log("I/O finished")
    console.log("-------------")

    setTimeout(() => console.log("Timer 2 finished"), 0)
    setTimeout(() => console.log("Timer 3 finished"), 3000)
    setImmediate(() => console.log("Immediate 2 finished"))

    process.nextTick(() => console.log("Process.nextTick"))

    crypto.pbkdf2('password', 'salt', 100000, 1024, 'sha512', () => {
        console.log(Date.now() - start, "Password encrypted")
    })

    crypto.pbkdf2('password', 'salt', 100000, 1024, 'sha512', () => {
        console.log(Date.now() - start, "Password encrypted")
    })

    crypto.pbkdf2('password', 'salt', 100000, 1024, 'sha512', () => {
        console.log(Date.now() - start, "Password encrypted")
    })

    crypto.pbkdf2('password', 'salt', 100000, 1024, 'sha512', () => {
        console.log(Date.now() - start, "Password encrypted")
    })


})

// 1. æ‰§è¡Œé¡¶å±‚ä»£ç 
console.log("Hello from the top-level code")
```

#### 3.4 å‘ç”Ÿäº‹ä»¶ä¸ç›‘å¬äº‹ä»¶

è¿è¡Œçš„è¿‡ç¨‹ï¼š

1. äº‹ä»¶å‘å‡º

2. äº‹ä»¶ç›‘å¬

3. è°ƒç”¨å›è°ƒå‡½æ•°

å…¶ä¸­ï¼Œ*1ã€2*è¢«ç§°ä½œè§‚å¯Ÿè€…æ¨¡å¼

**æœ¬åœ°äº‹ä»¶ç›‘å¬**

```js
const EventEmitter = require("events")

class Sales extends EventEmitter{
    constructor() {
        super();
    }
}

const myEmitter = new Sales()

// 2. ç›‘å¬äº‹ä»¶
// 3. æŒ‰é¡ºåºå¯ç”¨å›è°ƒå‡½æ•°
myEmitter.on("newSale", () => {
    console.log("There was a new sale!")
})

myEmitter.on("newSale", () => {
    console.log("Costumer name: Liu")
})

myEmitter.on("newSale", (stock) => {
    console.log(`There are now ${stock} items left in stock`)
})


// 1. å‘å‡ºäº‹ä»¶
myEmitter.emit("newSale");
```

**æœåŠ¡å™¨äº‹ä»¶ç›‘å¬**

```js
const http = require("http")


// 1. åˆ›å»ºç›‘å¬è€…
const server = http.createServer()

// 2. åˆ›å»ºæœåŠ¡å™¨ç›‘å¬è€…ï¼Œç›‘å¬æœåŠ¡å™¨è¿›è¡Œçš„äº‹ä»¶
server.on("request",(req,res) => {
    console.log("Request received!")
    res.end("Request received")
})

server.on("request",(req,res) => {
    console.log("Another request ğŸ˜€")
})

server.on("close",() => {
    console.log("Server closed")
})

// 3. åˆ›å»ºæœåŠ¡å™¨ç›‘å¬è€…ï¼Œç›‘å¬è¯·æ±‚åœ°å€
server.listen(8001,'127.0.0.1',()=>{
    console.log("Waiting for requests...")
})
```

#### 3.5 æµå¼ä¼ è¾“

è§£é‡Šï¼šç‰‡æ®µåœ°ä¼ è¾“æ•°æ®ï¼Œè¿‡ç¨‹ä¸­æ²¡æœ‰å®Œæˆæ•´ä¸ªè¯»å–ã€å†™å…¥æ“ä½œï¼Œä¸ä¼šä¸€ç›´å°†æ•°æ®ä¿å­˜åœ¨å­˜å‚¨ä¸­

æµçš„ç§ç±»ï¼š

| åç§°         | æè¿°                 | ä¾‹å­           |
| ---------- | ------------------ | ------------ |
| å¯è¯»æµ        | æµä¼ è¾“å¯è¯»å–çš„æ•°æ®          | httpè¯·æ±‚ã€æ–‡ä»¶è¯»å–æµ |
| å¯å†™æµ        | å‘æµä¼ è¾“å†™å…¥çš„æ•°æ®          | httpå“åº”ã€æ–‡ä»¶å†™å…¥æµ |
| åŒå·¥æµï¼ˆå¯å†™ã€å¯è¯»ï¼‰ | æµå¯ä¼ è¾“è¯»å–çš„æ•°æ®ã€å¯å‘é€å†™å…¥çš„æ•°æ® | socket       |
| è½¬æ¢æµ        | å¤šä¸ªæµï¼Œå¯è½¬æ¢ä¼ è¾“æˆ–å‘é€åŠŸèƒ½     | Gzip         |

#### 3.6 commonJsæ¨¡å—ç³»ç»Ÿ

1. æ¯ä¸ªjsæ–‡ä»¶éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—

2. Node.jsä½¿ç”¨`CommonJS`æ¨¡å—ç³»ç»Ÿ

3. ESæ¨¡å—ç³»ç»Ÿä½¿ç”¨åœ¨æµè§ˆå™¨ä¸Š

4. éƒ½å¯ä»¥åœ¨Nodeç¯å¢ƒä¸­ä½¿ç”¨

`require`æ—¶å‘ç”Ÿçš„äº‹æƒ…

1. æŒ‰é¡ºåºè¯»å–æ ¸å¿ƒæ¨¡å—ã€å¼€å‘è€…æ¨¡å—ï¼ˆè‡ªå®šä¹‰JSæ–‡ä»¶ï¼‰ã€`express`

2. åŒ…è£…æ¨¡å—

3. æ‰§è¡Œæ¨¡å—

4. è¿”å›è¾“å‡º

---

## ç¬¬å››ç«  Promise ç•¥

---

## ç¬¬äº”ç«  Express

#### 5.1 åŸºæœ¬ç†è®º

`Express`ï¼š

- å¾®å°å‹NodeJSæ¡†æ¶ï¼Œä¸€ä¸ªé«˜ç­‰çº§çš„æŠ½è±¡å±‚

- åŒ…å«å¥å£®ç»“æ„çš„é›†åˆï¼Œå¤æ‚è·¯ç”±ã€è¯·æ±‚å“åº”å¤„ç†ã€ä¸­é—´ä»¶ã€æœåŠ¡å™¨æ¸²æŸ“

- å¯ä»¥å¿«é€Ÿå¼€å‘åº”ç”¨ç¨‹åº

- ç”¨MVCæ¶æ„å¯ä»¥æ›´å®¹æ˜“åœ°ç»„ç»‡æˆ‘ä»¬åœ°åº”ç”¨ç¨‹åº

`API`ï¼šåº”ç”¨ç¨‹åºæ¥å£

`Rest`æ¶æ„ï¼š

- é€»è¾‘å±‚åˆ†ç¦»API

- æš´éœ²URLç»“æ„

- ä½¿ç”¨HTTPæ–¹æ³•

- ä»¥JSONæ ¼å¼å‘é€æ•°æ®

- ä¿æŒæ— çŠ¶æ€

è¯·æ±‚æ–¹å¼çš„ä½œç”¨

| åç§°     | ä½œç”¨  |
| ------ | --- |
| POST   | åˆ›å»º  |
| GET    | è¯»å–  |
| PUT    | æ›´æ–°  |
| PATCH  | æ›´æ–°  |
| DELETE | åˆ é™¤  |

æœåŠ¡å™¨ä¸­ä¸å¥½çš„åšæ³•

1. è®°å½•å‰ç«¯çš„çŠ¶æ€

2. è¯·æ±‚åŒ…å«èµ„æºï¼Œä¸è¦åŒ…å«æ“ä½œ

#### 5.2 ä¸­é—´ä»¶

è¯´æ˜ï¼šä¸­é—´ä»¶æ˜¯è¯·æ±‚ä¸å“åº”ä¹‹é—´å¯¹è¯·æ±‚ã€å“åº”å¯¹è±¡åš**è¾…åŠ©æ€§æ“ä½œ**çš„æ§ä»¶ï¼Œä¸­é—´ä»¶ä¸æ­¢ä¸€ä¸ªï¼Œå•ä¸ªè¯·æ±‚å“åº”ä¸­ï¼Œæ‰€æœ‰çš„ä¸­é—´ä»¶ç§°ä¸ºä¸­é—´ä»¶å †æ ˆ

ä½œç”¨ï¼š

1. åˆ†æè¯·æ±‚ä½“

2. ä½œæ—¥å¿—è®°å½•

3. è®¾ç½®è¯·æ±‚å¤´

4. è·¯ç”±æ“ä½œ

#### 5.3 ä¸­é—´ä»¶å†™æ³•

```js
const express = require('express')
const app = express();
const morgan = require('morgan')

// æ·»åŠ ä¸­é—´ä»¶
// 3. å¼•ç”¨å¤–éƒ¨é›†æˆçš„ä¸­é—´ä»¶
app.use(morgan('dev'));

// 2. è·å–è¯·æ±‚ä½“
app.use(express.json())

app.use((req, res, next) => {
    console.log('Hello from the middleware ğŸ˜')
    next()
})

// 1. åŸºæœ¬ä¸­é—´ä»¶ï¼Œæ¥æ”¶è¯·æ±‚ä¸å“åº”å¯¹è±¡
app.use((req, res, next) => {
    req.requestTime = new Date().toISOString()
    next()
})
```

#### 5.4 è·¯ç”±å†™æ³•

- åˆç‰ˆå†™æ³•ï¼Œè¯·æ±‚è¿æ¥ï¼Œè¿”å›å“åº”

```js
app.get('/',(req,res)=>{
    // res.status(200).send('Hello from the server side!')
    res
        .status(200)
        .json({messsage:'Hello from the server side!',app:'Natours'})
})

app.post('/',(req,res)=>{
    res.send('You can post to this endpoint...')
})
```

- äºŒç‰ˆå†™æ³•ï¼Œè·¯ç”±è¯·æ±‚ï¼Œå¤–éƒ¨æ–¹æ³•

```js
// å…¨éƒ¨è¯·æ±‚
app.get('/api/v1/tours', getAllTours)

// å‘½åå‚æ•°è¯·æ±‚
// ç›´æ¥è·å–æ ¼å¼ /:name
// å¯é€‰è·å–æ ¼å¼ /:name?
// params è¯»å–å‚æ•°
app.get('/api/v1/tours/:id', getIdTour)

// å‘é€è¯·æ±‚
app.post('/api/v1/tours', PostTour)

// å‘é€Patchè¯·æ±‚
app.patch('/api/v1/tours/:id', PatchTour)

// åˆ é™¤è¯·æ±‚
app.delete('/api/v1/tours/:id', deleteTour) .post(postUser)
```

- ä¸‰ç‰ˆå†™æ³•ï¼Œè·¯ç”±åœ°å€ï¼Œé“¾å¼è¯·æ±‚ï¼Œå¤–éƒ¨æ–¹æ³•

```js
app.route('/api/v1/users')
    .get(getAllUsers)
    .post(postUser)

app.route('/api/v1/users/:id')
    .get(getIdUser)
    .patch(updateUser)
    .delete(deleteUser)
```

- å››ç‰ˆå†™æ³•
  
  1. ç”Ÿæˆè·¯ç”±å™¨å¯¹è±¡ï¼Œé…ç½®ç›®æ ‡åœ°å€ã€é“¾å¼è¯·æ±‚æ–¹æ³•
  
  2. æœåŠ¡å™¨å¯¹è±¡é…ç½®æºåœ°å€ï¼Œè·¯ç”±å™¨å¯¹è±¡

```js
// è·¯ç”±è¿æ¥
const tourRouter = express.Router();
const userRouter = express.Router();

// é‡æ„å†™æ³•
tourRouter.route('/')
    .get(getAllTours)
    .post(postTour)

tourRouter.route('/:id')
    .get(getIdTour)
    .patch(updateTour)
    .delete(deleteTour)

userRouter.route('/api/v1/users')
    .get(getAllUsers)
    .post(postUser)

userRouter.route('/api/v1/users/:id')
    .get(getIdUser)
    .patch(updateUser)
    .delete(deleteUser)


app.use('/api/v1/tours', tourRouter)
app.use('/api/v1/users', userRouter)
```
