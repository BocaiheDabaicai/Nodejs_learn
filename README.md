## 第九章 用户注册、认证、授权

#### 9.1 用户注册

#### 9.2 用户认证

主要是设置密码加密、以及登录认证获取`token`的内容

> 重点
> 
> 使用登录密码与数据库加密的密码进行比较，正确再传回`token`给用户

登录成功后，用户与真实数据之间的交互，设计方案如下：

1. 请求头携带`token`

2. `token`的有效时间

3. 用户是否修改密码

在2过期、3修改的情况下，要对`token`进行处理，保护数据安全

#### 9.5 数据安全

- 数据库受损

采用加密密码和加密密码重置`token`两种策略，降低数据库出现风险的几率

- 强行攻击

减慢登录请求的速度，执行请求限制，执行单个IP限定请求数量

- 跨站脚本攻击（xss）

**不要将token存储在本地存储中**，仅存储在http的`cookie`中，用于发送和获取数据，定期清理用户的输入数据，设置特殊的请求标头

- 拒绝服务攻击（dos）

限制请求速率、限制请求数量、避免未知的正则表达式

- 非结构化查询注入攻击

使用`mongoose`进行查询，清理用户输入的数据

- 实践建议
  
  1. 使用`https`
  
  2. 使用随机密码在到期时间重置`token`
  
  3. 拒绝在密码更改后连接请求
  
  4. 不要在`git`上提交敏感配置数据
  
  5. 不要发送给客户端错误信息的细节
  
  6. 预防跨端请求
  
  7. 高价值数据获取之前需要提供重认证
  
  8. 列出不信任的请求黑名单
  
  9. 创建用户时认证用户邮件地址
  
  10. 保持用户登录时使用更新的`token`
  
  11. 执行两端认证
  
  12. 预防参数污染导致未知错误

> cookie
